name: Agent Health Check

on:
  push:
    branches: [main]
    paths: ["AGENTS.md", "HEARTBEAT.md"]
  schedule:
    - cron: "0 8 * * *"
  workflow_dispatch:

jobs:
  health-check:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Check AGENTS.md
        run: |
          echo "=== Agent Count ==="
          grep -c "^## " AGENTS.md
          echo "=== Agents ==="
          grep "^## " AGENTS.md
          echo "=== Models ==="
          grep "Modell:" AGENTS.md
          echo "=== Providers ==="
          grep "Provider:" AGENTS.md | sort | uniq -c

      - name: Validate Skills Count
        run: |
          SKILLS=$(grep -cE '^\s+[0-9]+\.' AGENTS.md || true)
          echo "Total skill assignments in AGENTS.md: $SKILLS"
          UNIQUE=$(grep -oE '^\s+[0-9]+\.\s+\S+' AGENTS.md | awk '{print $2}' | sort -u | wc -l)
          echo "Unique skills: $UNIQUE"
          if [ "$UNIQUE" -lt 55 ]; then
            echo "::warning::Unique skill count below 55!"
          else
            echo "Skills OK ($UNIQUE unique, $SKILLS total assignments)"
          fi
